<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
	<title>隔期重号走势图</title>
	<link rel="stylesheet" href="../lib/weui/weui.css">
	<link href="../lib/font-awesome/css/font-awesome.min.css" rel="stylesheet">
	<link rel="stylesheet" href="../app.css">
</head>
<body>

	<a href="../app.html" style="border:none; z-index:9999; opacity:0.6; display:flex; align-items:center; justify-content:center; width:40px; height:40px; top:5px; right:5px; position:absolute; border-radius:5px; background-color:#666666; color:#ffffff;"><i class="fa fa-home" style="font-size:22px;"></i></a>


<div id="master-module">
	<div class="sub-module chart-module">
		<div id="chart-panel">

			<div style="display:flex">
				<div class="weui-cell weui-cell_select" style="flex-grow:1">
					<div class="weui-cell__bd">
						<select class="weui-select" id="11x5-length"></select>
					</div>
				</div>
				<div class="weui-cell weui-cell_select" style="flex-grow:1">
					<div class="weui-cell__bd">
						<select class="weui-select" id="11x5-type"></select>
					</div>
				</div>
			</div>
			<div id="detailed-panel">
			<table>
				<thead>
				<tr>
					<th rowspan="2" style="width:100px; min-width:100px">期号</th>
					<th rowspan="2" colspan="5">开奖号码</th>
					<th colspan="6">隔一期重号</th>
					<th colspan="6">隔二期重号</th>
					<th colspan="6">隔三期重号</th>
					<th colspan="6">隔四期重号</th>
					<th colspan="6">隔五期重号</th>
					<th colspan="6">隔六期重号</th>
					<th colspan="6">隔七期重号</th>
					<th colspan="6">隔八期重号</th>
					<th colspan="6">隔九期重号</th>
					<th colspan="6">隔十期重号</th>
				</tr>
				<tr>
					<th>0</th>
					<th>1</th>
					<th>2</th>
					<th>3</th>
					<th>4</th>
					<th>5</th>
					<th>0</th>
					<th>1</th>
					<th>2</th>
					<th>3</th>
					<th>4</th>
					<th>5</th>
					<th>0</th>
					<th>1</th>
					<th>2</th>
					<th>3</th>
					<th>4</th>
					<th>5</th>
					<th>0</th>
					<th>1</th>
					<th>2</th>
					<th>3</th>
					<th>4</th>
					<th>5</th>
					<th>0</th>
					<th>1</th>
					<th>2</th>
					<th>3</th>
					<th>4</th>
					<th>5</th>
					<th>0</th>
					<th>1</th>
					<th>2</th>
					<th>3</th>
					<th>4</th>
					<th>5</th>
					<th>0</th>
					<th>1</th>
					<th>2</th>
					<th>3</th>
					<th>4</th>
					<th>5</th>
					<th>0</th>
					<th>1</th>
					<th>2</th>
					<th>3</th>
					<th>4</th>
					<th>5</th>
					<th>0</th>
					<th>1</th>
					<th>2</th>
					<th>3</th>
					<th>4</th>
					<th>5</th>
					<th>0</th>
					<th>1</th>
					<th>2</th>
					<th>3</th>
					<th>4</th>
					<th>5</th>
				</tr>
				</thead>
				<tbody></tbody>
			</table>
			</div>

			<div id="statistics-panel">
			<table>
				<thead>
				<tr>
					<th rowspan="2" style="width:230px; min-width:230px">统计类型</th>
					<th colspan="6">隔一期重号</th>
					<th colspan="6">隔二期重号</th>
					<th colspan="6">隔三期重号</th>
					<th colspan="6">隔四期重号</th>
					<th colspan="6">隔五期重号</th>
					<th colspan="6">隔六期重号</th>
					<th colspan="6">隔七期重号</th>
					<th colspan="6">隔八期重号</th>
					<th colspan="6">隔九期重号</th>
					<th colspan="6">隔十期重号</th>
				</tr>
				<tr>
					<th>0</th>
					<th>1</th>
					<th>2</th>
					<th>3</th>
					<th>4</th>
					<th>5</th>
					<th>0</th>
					<th>1</th>
					<th>2</th>
					<th>3</th>
					<th>4</th>
					<th>5</th>
					<th>0</th>
					<th>1</th>
					<th>2</th>
					<th>3</th>
					<th>4</th>
					<th>5</th>
					<th>0</th>
					<th>1</th>
					<th>2</th>
					<th>3</th>
					<th>4</th>
					<th>5</th>
					<th>0</th>
					<th>1</th>
					<th>2</th>
					<th>3</th>
					<th>4</th>
					<th>5</th>
					<th>0</th>
					<th>1</th>
					<th>2</th>
					<th>3</th>
					<th>4</th>
					<th>5</th>
					<th>0</th>
					<th>1</th>
					<th>2</th>
					<th>3</th>
					<th>4</th>
					<th>5</th>
					<th>0</th>
					<th>1</th>
					<th>2</th>
					<th>3</th>
					<th>4</th>
					<th>5</th>
					<th>0</th>
					<th>1</th>
					<th>2</th>
					<th>3</th>
					<th>4</th>
					<th>5</th>
					<th>0</th>
					<th>1</th>
					<th>2</th>
					<th>3</th>
					<th>4</th>
					<th>5</th>
				</tr>
				</thead>
				<tbody></tbody>
			</table>
			</div>
		</div>
	</div>
</div>
	<script src="../../lib/app.js"></script>
	<script type="text/javascript" src="../lib/jquery.min.js"></script>
	
	
	<script type="text/javascript">

		var map = {};
		$(function()
		{
			$.ajaxSetup 
			(
				{
					async:false
				}
			);
			$.getJSON("../../11x5/dictionary/list/type.json", function(items)
			{
				$.each(items, function(i, item)
				{
					$("#11x5-type").append('<option value="'+item['k']+'">'+item['v']+'</option>');
				});
			});

			$.getJSON("../../11x5/dictionary/list/length.json", function(items)
			{
				$.each(items, function(i, item)
				{
					$("#11x5-length").append('<option value="'+item['k']+'">'+item['v']+'</option>');
				});
			});

			$("#11x5-type").on("change", function()
			{
				initialise( $("#11x5-length").val(), $(this).val() );
			});

			$("#11x5-length").on("change", function()
			{
				initialise( $(this).val(), $("#11x5-type").val() );
			});
			initialise($("#11x5-length").val(), $("#11x5-type").val() );
		});

		var colors = 
		{
			"1":"yellowrect",
			"2":"greenrect",
			"3":"bluerect",
			"4":"purplerect",
			"5":"seagreenrect",
			"6":"yellowrect",
			"7":"greenrect",
			"8":"bluerect",
			"9":"purplerect",
			"10":"seagreenrect"
		}

		function repeatcontent(codes, prerow, index)
		{
			var content = "";
			
			var repcount = 0;
			if(prerow != null)
			{
				var precodes = prerow["CODE"].split(",");
				repcount = app.repeatcount(codes, precodes);
			}

			for(var i = 0 ; i <= 5 ; i++)
			{
				var value = map[index+'-'+i];
				if(value == null)
				{
					value = 1;
					map[index+'-'+i] = 1;
				}
				if(i == repcount)
				{
					value = '<span class="'+colors[index]+'">'+i+'</span>';
					map[index+'-'+i] = 1;
					
					if(map[index+'-'+i+'-sum'] == null)
					{
						map[index+'-'+i+'-sum'] = 1;
					}
					else
					{
						map[index+'-'+i+'-sum'] += 1;
					}


					if(map[index+'-'+i+'-contemp'] == null)
					{
						map[index+'-'+i+'-contemp'] = 1;
					}
					else
					{
						map[index+'-'+i+'-contemp'] += 1;
					}
				}
				else
				{
					map[index+'-'+i] = value + 1;
					
					if(map[index+'-'+i+'-lose'] == null)
					{
						map[index+'-'+i+'-lose'] = 1;
					}
					else
					{
						map[index+'-'+i+'-lose'] += 1;
					}

					if(map[index+'-'+i+'-contemp'] != null)
					{
						if(map[index+'-'+i+'-con'] == null)
						{
							map[index+'-'+i+'-con'] = map[index+'-'+i+'-contemp'];
						}
						else
						{
							map[index+'-'+i+'-con'] = Math.max(map[index+'-'+i+'-contemp'], map[index+'-'+i+'-con'])
						}
						map[index+'-'+i+'-contemp'] = 0;
					}
				}
				content += '<td class="greycode">'+value+'</td>';
			}

			return content;
		}

		function initialise(length, type)
		{
			app.showLoading();
			$.getJSON("../../11x5/service/data.jsp?mode=1&length="+length+"&type="+type, function(response)
			{
				if(response.status == 1)
				{
					var rows = response.resource.data;
					var $detailed = $("#detailed-panel table tbody");
					var content = '';
					for(var i = 10 ; i < rows.length ; i++)
					{
						var row = rows[i];
						var codes = row["CODE"].split(",")
						content += '<tr>';
						content += '<td>'+row["PHASE"]+'</td>';
						content += '<td class="redcode">'+codes[0]+'</td>';
						content += '<td class="redcode">'+codes[1]+'</td>';
						content += '<td class="redcode">'+codes[2]+'</td>';
						content += '<td class="redcode">'+codes[3]+'</td>';
						content += '<td class="redcode">'+codes[4]+'</td>';

						content += repeatcontent(codes, rows[i - 1], 1);
						content += repeatcontent(codes, rows[i - 2], 2);
						content += repeatcontent(codes, rows[i - 3], 3);
						content += repeatcontent(codes, rows[i - 4], 4);
						content += repeatcontent(codes, rows[i - 5], 5);
						content += repeatcontent(codes, rows[i - 6], 6);
						content += repeatcontent(codes, rows[i - 7], 7);
						content += repeatcontent(codes, rows[i - 8], 8);
						content += repeatcontent(codes, rows[i - 9], 9);
						content += repeatcontent(codes, rows[i - 10], 10);

						content += '</tr>';
					}
					$detailed.html(content);					

					var $statistics = $("#statistics-panel table tbody");

					var tempstatisticsmap = {};
					var statisticsmap = {};
					var $rows = $detailed.find("tr");
					$.each($rows, function(i, row)
					{
						var $cells = $(row).find("td");
						$.each($cells, function(j, cell)
						{
							var $cell = $(cell);
							var classname = "L"+$cell.attr("class");
							var isBingo = ($cell.find("span").length != 0);

							if(tempstatisticsmap[classname] == null)
							{
								tempstatisticsmap[classname] = 0;
							}

							if(isBingo)
							{
								tempstatisticsmap[classname] += 1;
							}

							if(!isBingo || (i == $rows.length - 1))
							{
								statisticsmap[classname] = Math.max((statisticsmap[classname] || 0), (tempstatisticsmap[classname] || 0));
								tempstatisticsmap[classname] = 0;
							}

							classname = "Y"+$cell.attr("class");
							if(tempstatisticsmap[classname] == null)
							{
								tempstatisticsmap[classname] = 0;
							}

							if(!isBingo)
							{
								tempstatisticsmap[classname] += 1;
							}
							
							if(isBingo || (i == $rows.length - 1))
							{
								statisticsmap[classname] = Math.max((statisticsmap[classname] || 0), (tempstatisticsmap[classname] || 0));
								tempstatisticsmap[classname] = 0;
							}
						});
						
					});

					content = "";

					content += '<tr>';
					content += '<td>出现总次数</td>';
					
					for(var i = 1 ; i <= 10 ; i++)
					{
						for(var l = 0 ; l <= 5 ; l++)
						{
							content += '<td>'+(map[''+i+'-'+l+'-sum'] || 0)+'</td>';
						}
					}

					content += '</tr>';

					content += '<tr class="bluerow">';
					content += '<td>最大遗漏值</td>';					
					for(var i = 1 ; i <= 10 ; i++)
					{
						for(var l = 0 ; l <= 5 ; l++)
						{
							content += '<td>'+(map[''+i+'-'+l+'-lose'] || 0)+'</td>';
						}
					}
					content += '</tr>';

					content += '<tr>';
					content += '<td>最大连出值</td>';				
					for(var i = 1 ; i <= 10 ; i++)
					{
						for(var l = 0 ; l <= 5 ; l++)
						{
							content += '<td>'+(map[''+i+'-'+l+'-con'] || 0)+'</td>';
						}
					}
					content += '</tr>';

					$statistics.html(content);
					app.hideLoading();


				}
				else
				{
					app.hideLoading();
					app.message(response.messages);
				}
			});
		}
	</script>

</body>
</html>
